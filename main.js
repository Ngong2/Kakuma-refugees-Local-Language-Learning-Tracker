// Language data with translations
 const languageData = {
    "english": {
        "swahili": [
            { native: "Water", translation: "Maji" },
            { native: "Food", translation: "Chakula" },
            { native: "House", translation: "Nyumba" },
            { native: "Person", translation: "Mtu" },
            { native: "School", translation: "Shule" }
        ],
        "dinka": [
            { native: "Water", translation: "piu" },
            { native: "Food", translation: "cuin" },
            { native: "House", translation: "Hot" },
            { native: "Person", translation: "Raan" },
            { native: "School", translation: "thukul" }
        ],
        "nuer": [
            { native: "Water", translation: "Pi" },
            { native: "Food", translation: "Miɛth" },
            { native: "House", translation: "Duël" },
            { native: "Person", translation: "Raan" },
            { native: "School", translation: "Thukul" }
        ],
        "somali": [
            { native: "Water", translation: "Biyo" },
            { native: "Food", translation: "Cunto" },
            { native: "House", translation: "Guri" },
            { native: "Person", translation: "Qof" },
            { native: "School", translation: "Iskuul" }
        ],
        "amharic": [
            { native: "Water", translation: "ውሃ" },
            { native: "Food", translation: "ምግብ" },
            { native: "House", translation: "ቤት" },
            { native: "Person", translation: "ሰው" },
            { native: "School", translation: "ትምህርት ቤት" }
        ],
        "french": [
            { native: "Water", translation: "Eau" },
            { native: "Food", translation: "Nourriture" },
            { native: "House", translation: "Maison" },
            { native: "Person", translation: "Personne" },
            { native: "School", translation: "École" }
        ],
        "arabic": [
            { native: "Water", translation: "ماء" },
            { native: "Food", translation: "طعام" },
            { native: "House", translation: "بيت" },
            { native: "Person", translation: "شخص" },
            { native: "School", translation: "مدرسة" }
        ]
    },
    "swahili": {
        "english": [
            { native: "Maji", translation: "Water" },
            { native: "Chakula", translation: "Food" },
            { native: "Nyumba", translation: "House" },
            { native: "Mtu", translation: "Person" },
            { native: "Shule", translation: "School" }
        ],
        "dinka": [
            { native: "Maji", translation: "piu" },
            { native: "Chakula", translation: "cuin" },
            { native: "Nyumba", translation: "hot" },
            { native: "Mtu", translation: "Raan" },
            { native: "Shule", translation: "thukul" }
        ],
        "nuer": [
            { native: "Maji", translation: "Pi" },
            { native: "Chakula", translation: "Miɛth" },
            { native: "Nyumba", translation: "Duël" },
            { native: "Mtu", translation: "Raan" },
            { native: "Shule", translation: "Thukul" }
        ],
        "somali": [
            { native: "Maji", translation: "Biyo" },
            { native: "Chakula", translation: "Cunto" },
            { native: "Nyumba", translation: "Guri" },
            { native: "Mtu", translation: "Qof" },
            { native: "Shule", translation: "Iskuul" }
        ],
        "amharic": [
            { native: "Maji", translation: "ውሃ" },
            { native: "Chakula", translation: "ምግብ" },
            { native: "Nyumba", translation: "ቤት" },
            { native: "Mtu", translation: "ሰው" },
            { native: "Shule", translation: "ትምህርት ቤት" }
        ],
        "french": [
            { native: "Maji", translation: "Eau" },
            { native: "Chakula", translation: "Nourriture" },
            { native: "Nyumba", translation: "Maison" },
            { native: "Mtu", translation: "Personne" },
            { native: "Shule", translation: "École" }
        ],
        "arabic": [
            { native: "Maji", translation: "ماء" },
            { native: "Chakula", translation: "طعام" },
            { native: "Nyumba", translation: "بيت" },
            { native: "Mtu", translation: "شخص" },
            { native: "Shule", translation: "مدرسة" }
        ]
    },
    "dinka": {
        "english": [
            { native: "piu", translation: "Water" },
            { native: "cuin", translation: "Food" },
            { native: "hot", translation: "House" },
            { native: "Raan", translation: "Person" },
            { native: "thukul", translation: "School" }
        ],
        "swahili": [
            { native: "piu", translation: "Maji" },
            { native: "cuin", translation: "Chakula" },
            { native: "hot", translation: "Nyumba" },
            { native: "Raan", translation: "Mtu" },
            { native: "thukul", translation: "Shule" }
        ],
        "nuer": [
            { native: "piu", translation: "Pi" },
            { native: "cuin", translation: "Miɛth" },
            { native: "hot", translation: "Duël" },
            { native: "Raan", translation: "Raan" },
            { native: "thukul", translation: "Thukul" }
        ],
        "somali": [
            { native: "piu", translation: "Biyo" },
            { native: "cuin", translation: "Cunto" },
            { native: "hot", translation: "Guri" },
            { native: "Raan", translation: "Qof" },
            { native: "thukul", translation: "Iskuul" }
        ],
        "amharic": [
            { native: "piu", translation: "ውሃ" },
            { native: "cuin", translation: "ምግብ" },
            { native: "hot", translation: "ቤት" },
            { native: "Raan", translation: "ሰው" },
            { native: "thukul", translation: "ትምህርት ቤት" }
        ],
        "french": [
            { native: "piu", translation: "Eau" },
            { native: "cuin", translation: "Nourriture" },
            { native: "hot", translation: "Maison" },
            { native: "Raan", translation: "Personne" },
            { native: "thukul", translation: "École" }
        ],
        "arabic": [
            { native: "piu", translation: "ماء" },
            { native: "cuin", translation: "طعام" },
            { native: "hot", translation: "بيت" },
            { native: "Raan", translation: "شخص" },
            { native: "thukul", translation: "مدرسة" }
        ]
    },
    "nuer": {
        "english": [
            { native: "Pi", translation: "Water" },
            { native: "Miɛth", translation: "Food" },
            { native: "Duël", translation: "House" },
            { native: "Raan", translation: "Person" },
            { native: "Thukul", translation: "School" }
        ],
        "swahili": [
            { native: "Pi", translation: "Maji" },
            { native: "Miɛth", translation: "Chakula" },
            { native: "Duël", translation: "Nyumba" },
            { native: "Raan", translation: "Mtu" },
            { native: "Thukul", translation: "Shule" }
        ],
        "dinka": [
            { native: "Pi", translation: "piu" },
            { native: "Miɛth", translation: "cuin" },
            { native: "Duël", translation: "hot" },
            { native: "Raan", translation: "Raan" },
            { native: "Thukul", translation: "thukul" }
        ],
        "somali": [
            { native: "Pi", translation: "Biyo" },
            { native: "Miɛth", translation: "Cunto" },
            { native: "Duël", translation: "Guri" },
            { native: "Raan", translation: "Qof" },
            { native: "Thukul", translation: "Iskuul" }
        ],
        "amharic": [
            { native: "Pi", translation: "ውሃ" },
            { native: "Miɛth", translation: "ምግብ" },
            { native: "Duël", translation: "ቤት" },
            { native: "Raan", translation: "ሰው" },
            { native: "Thukul", translation: "ትምህርት ቤት" }
        ],
        "french": [
            { native: "Pi", translation: "Eau" },
            { native: "Miɛth", translation: "Nourriture" },
            { native: "Duël", translation: "Maison" },
            { native: "Raan", translation: "Personne" },
            { native: "Thukul", translation: "École" }
        ],
        "arabic": [
            { native: "Pi", translation: "ماء" },
            { native: "Miɛth", translation: "طعام" },
            { native: "Duël", translation: "بيت" },
            { native: "Raan", translation: "شخص" },
            { native: "Thukul", translation: "مدرسة" }
        ]
    },
    "somali": {
        "english": [
            { native: "Biyo", translation: "Water" },
            { native: "Cunto", translation: "Food" },
            { native: "Guri", translation: "House" },
            { native: "Qof", translation: "Person" },
            { native: "Iskuul", translation: "School" }
        ],
        "swahili": [
            { native: "Biyo", translation: "Maji" },
            { native: "Cunto", translation: "Chakula" },
            { native: "Guri", translation: "Nyumba" },
            { native: "Qof", translation: "Mtu" },
            { native: "Iskuul", translation: "Shule" }
        ],
        "dinka": [
            { native: "Biyo", translation: "piu" },
            { native: "Cunto", translation: "cuin" },
            { native: "Guri", translation: "hot" },
            { native: "Qof", translation: "Raan" },
            { native: "Iskuul", translation: "thukul" }
        ],
        "nuer": [
            { native: "Biyo", translation: "Pi" },
            { native: "Cunto", translation: "Miɛth" },
            { native: "Guri", translation: "Duël" },
            { native: "Qof", translation: "Raan" },
            { native: "Iskuul", translation: "Thukul" }
        ],
        "amharic": [
            { native: "Biyo", translation: "ውሃ" },
            { native: "Cunto", translation: "ምግብ" },
            { native: "Guri", translation: "ቤት" },
            { native: "Qof", translation: "ሰው" },
            { native: "Iskuul", translation: "ትምህርት ቤት" }
        ],
        "french": [
            { native: "Biyo", translation: "Eau" },
            { native: "Cunto", translation: "Nourriture" },
            { native: "Guri", translation: "Maison" },
            { native: "Qof", translation: "Personne" },
            { native: "Iskuul", translation: "École" }
        ],
        "arabic": [
            { native: "Biyo", translation: "ماء" },
            { native: "Cunto", translation: "طعام" },
            { native: "Guri", translation: "بيت" },
            { native: "Qof", translation: "شخص" },
            { native: "Iskuul", translation: "مدرسة" }
        ]
    },
    "amharic": {
        "english": [
            { native: "ውሃ", translation: "Water" },
            { native: "ምግብ", translation: "Food" },
            { native: "ቤት", translation: "House" },
            { native: "ሰው", translation: "Person" },
            { native: "ትምህርት ቤት", translation: "School" }
        ],
        "swahili": [
            { native: "ውሃ", translation: "Maji" },
            { native: "ምግብ", translation: "Chakula" },
            { native: "ቤት", translation: "Nyumba" },
            { native: "ሰው", translation: "Mtu" },
            { native: "ትምህርት ቤት", translation: "Shule" }
        ],
        "dinka": [
            { native: "ውሃ", translation: "piu" },
            { native: "ምግብ", translation: "cuin" },
            { native: "ቤት", translation: "hot" },
            { native: "ሰው", translation: "Raan" },
            { native: "ትምህርት ቤት", translation: "thukul" }
        ],
        "nuer": [
            { native: "ውሃ", translation: "Pi" },
            { native: "ምግብ", translation: "Miɛth" },
            { native: "ቤት", translation: "Duël" },
            { native: "ሰው", translation: "Raan" },
            { native: "ትምህርት ቤት", translation: "Thukul" }
        ],
        "somali": [
            { native: "ውሃ", translation: "Biyo" },
            { native: "ምግብ", translation: "Cunto" },
            { native: "ቤት", translation: "Guri" },
            { native: "ሰው", translation: "Qof" },
            { native: "ትምህርት ቤት", translation: "Iskuul" }
        ],
        "french": [
            { native: "ውሃ", translation: "Eau" },
            { native: "ምግብ", translation: "Nourriture" },
            { native: "ቤት", translation: "Maison" },
            { native: "ሰው", translation: "Personne" },
            { native: "ትምህርት ቤት", translation: "École" }
        ],
        "arabic": [
            { native: "ውሃ", translation: "ماء" },
            { native: "ምግብ", translation: "طعام" },
            { native: "ቤት", translation: "بيت" },
            { native: "ሰው", translation: "شخص" },
            { native: "ትምህርት ቤት", translation: "مدرسة" }
        ]
    },
    "french": {
        "english": [
            { native: "Eau", translation: "Water" },
            { native: "Nourriture", translation: "Food" },
            { native: "Maison", translation: "House" },
            { native: "Personne", translation: "Person" },
            { native: "École", translation: "School" }
        ],
        "swahili": [
            { native: "Eau", translation: "Maji" },
            { native: "Nourriture", translation: "Chakula" },
            { native: "Maison", translation: "Nyumba" },
            { native: "Personne", translation: "Mtu" },
            { native: "École", translation: "Shule" }
        ],
        "dinka": [
            { native: "Eau", translation: "piu" },
            { native: "Nourriture", translation: "cuin" },
            { native: "Maison", translation: "hot" },
            { native: "Personne", translation: "Raan" },
            { native: "École", translation: "thukul" }
        ],
        "nuer": [
            { native: "Eau", translation: "Pi" },
            { native: "Nourriture", translation: "Miɛth" },
            { native: "Maison", translation: "Duël" },
            { native: "Personne", translation: "Raan" },
            { native: "École", translation: "Thukul" }
        ],
        "somali": [
            { native: "Eau", translation: "Biyo" },
            { native: "Nourriture", translation: "Cunto" },
            { native: "Maison", translation: "Guri" },
            { native: "Personne", translation: "Qof" },
            { native: "École", translation: "Iskuul" }
        ],
        "amharic": [
            { native: "Eau", translation: "ውሃ" },
            { native: "Nourriture", translation: "ምግብ" },
            { native: "Maison", translation: "ቤት" },
            { native: "Personne", translation: "ሰው" },
            { native: "École", translation: "ትምህርት ቤት" }
        ],
        "arabic": [
            { native: "Eau", translation: "ماء" },
            { native: "Nourriture", translation: "طعام" },
            { native: "Maison", translation: "بيت" },
            { native: "Personne", translation: "شخص" },
            { native: "École", translation: "مدرسة" }
        ]
    },
    "arabic": {
        "english": [
            { native: "ماء", translation: "Water" },
            { native: "طعام", translation: "Food" },
            { native: "بيت", translation: "House" },
            { native: "شخص", translation: "Person" },
            { native: "مدرسة", translation: "School" }
        ],
        "swahili": [
            { native: "ماء", translation: "Maji" },
            { native: "طعام", translation: "Chakula" },
            { native: "بيت", translation: "Nyumba" },
            { native: "شخص", translation: "Mtu" },
            { native: "مدرسة", translation: "Shule" }
        ],
        "dinka": [
            { native: "ماء", translation: "piu" },
            { native: "طعام", translation: "cuin" },
            { native: "بيت", translation: "hot" },
            { native: "شخص", translation: "Raan" },
            { native: "مدرسة", translation: "thukul" }
        ],
        "nuer": [
            { native: "ماء", translation: "Pi" },
            { native: "طعام", translation: "Miɛth" },
            { native: "بيت", translation: "Duël" },
            { native: "شخص", translation: "Raan" },
            { native: "مدرسة", translation: "Thukul" }
        ],
        "somali": [
            { native: "ماء", translation: "Biyo" },
            { native: "طعام", translation: "Cunto" },
            { native: "بيت", translation: "Guri" },
            { native: "شخص", translation: "Qof" },
            { native: "مدرسة", translation: "Iskuul" }
        ],
        "amharic": [
            { native: "ماء", translation: "ውሃ" },
            { native: "طعام", translation: "ምግብ" },
            { native: "بيت", translation: "ቤት" },
            { native: "شخص", translation: "ሰው" },
            { native: "مدرسة", translation: "ትምህርት ቤት" }
        ],
        "french": [
            { native: "ماء", translation: "Eau" },
            { native: "طعام", translation: "Nourriture" },
            { native: "بيت", translation: "Maison" },
            { native: "شخص", translation: "Personne" },
            { native: "مدرسة", translation: "École" }
        ]
    }
}

// Vocabulary data

// App state
const state = {
    nativeLanguage: "english",
    targetLanguage: "swahili",
    vocabulary: [],
    learnedWords: 0,
    learningStreak: 0,
    lastPracticeDate: null,
    vocabProgress: 0,
    grammarProgress: 0,
    convoProgress: 0
};

// DOM elements
const elements = {
    nativeLanguageSelect: document.getElementById('nativeLanguage'),
    targetLanguageSelect: document.getElementById('targetLanguage'),
    changeLanguageBtn: document.getElementById('changeLanguage'),
    vocabularyList: document.getElementById('vocabularyList'),
    nativeWordInput: document.getElementById('nativeWordInput'),
    translationInput: document.getElementById('translationInput'),
    addWordBtn: document.getElementById('addWordBtn'),
    wordsLearned: document.getElementById('wordsLearned'),
    learningStreak: document.getElementById('learningStreak'),
    completion: document.getElementById('completion'),
    vocabProgress: document.getElementById('vocabProgress'),
    vocabCount: document.getElementById('vocabCount'),
    vocabTotal: document.getElementById('vocabTotal'),
    grammarProgress: document.getElementById('grammarProgress'),
    grammarCount: document.getElementById('grammarCount'),
    grammarTotal: document.getElementById('grammarTotal'),
    convoProgress: document.getElementById('convoProgress'),
    convoCount: document.getElementById('convoCount'),
    convoTotal: document.getElementById('convoTotal'),
    vocabSearch: document.getElementById('vocabSearch'),
    practiceModal: document.getElementById('practiceModal'),
    closeModal: document.querySelector('.close-modal'),
    practiceArea: document.getElementById('practiceArea'),
    practiceTitle: document.getElementById('practiceTitle'),
    nextPractice: document.getElementById('nextPractice'),
    practiceVocabBtn: document.getElementById('practiceVocabBtn'),
    practiceGrammarBtn: document.getElementById('practiceGrammarBtn'),
    practiceConvoBtn: document.getElementById('practiceConvoBtn')
};

// Initialize the app
function init() {
    loadState();
    setupEventListeners();
    updateUI();
    loadVocabulary();
}

// Load saved state from localStorage
function loadState() {
    const savedState = localStorage.getItem('languageTrackerState');
    if (savedState) {
        Object.assign(state, JSON.parse(savedState));
        elements.nativeLanguageSelect.value = state.nativeLanguage;
        elements.targetLanguageSelect.value = state.targetLanguage;
    }
}

// Save state to localStorage
function saveState() {
    localStorage.setItem('languageTrackerState', JSON.stringify(state));
}

// Set up event listeners
function setupEventListeners() {
    elements.changeLanguageBtn.addEventListener('click', changeLanguage);
    elements.addWordBtn.addEventListener('click', addWord);
    elements.vocabSearch.addEventListener('input', searchVocabulary);
    elements.closeModal.addEventListener('click', closePracticeModal);
    elements.nextPractice.addEventListener('click', nextPracticeItem);
    
    // Add proper event listeners for practice buttons
    elements.practiceVocabBtn.addEventListener('click', () => startPractice('vocabulary'));
    elements.practiceConvoBtn.addEventListener('click', () => startPractice('conversation'));
    elements.practiceGrammarBtn.addEventListener('click', () => startPractice('grammar'));
    
    // Close modal when clicking outside
    window.addEventListener('click', (e) => {
        if (e.target === elements.practiceModal) {
            closePracticeModal();
        }
    });
}

// Change the language pair
function changeLanguage() {
    state.nativeLanguage = elements.nativeLanguageSelect.value;
    state.targetLanguage = elements.targetLanguageSelect.value;
    saveState();
    loadVocabulary();
    updateUI();
}

// Load vocabulary for current language pair
function loadVocabulary() {
    const nativeLang = state.nativeLanguage;
    const targetLang = state.targetLanguage;
    
    if (languageData[nativeLang] && languageData[nativeLang][targetLang]) {
        // Direct translation exists
        state.vocabulary = [...languageData[nativeLang][targetLang]];
    } else if (languageData[targetLang] && languageData[targetLang][nativeLang]) {
        // Reverse the translation if direct one doesn't exist
        state.vocabulary = languageData[targetLang][nativeLang].map(word => ({
            native: word.translation,
            translation: word.native
        }));
    } else {
        // No translation available
        state.vocabulary = [];
    }
    
    renderVocabulary();
}

// Render vocabulary list
function renderVocabulary() {
    elements.vocabularyList.innerHTML = '';
    
    state.vocabulary.forEach((word, index) => {
        const wordElement = document.createElement('div');
        wordElement.className = 'vocabulary-item';
        wordElement.innerHTML = `
            <div class="word-info">
                <div class="native-word">${word.native}</div>
                <div class="translation">${word.translation}</div>
            </div>
            <div class="word-actions">
                <button class="edit-word" data-index="${index}"><i class="fas fa-edit"></i></button>
                <button class="delete-word" data-index="${index}"><i class="fas fa-trash"></i></button>
            </div>
        `;
        elements.vocabularyList.appendChild(wordElement);
    });
    
    // Add event listeners to action buttons
    document.querySelectorAll('.edit-word').forEach(btn => {
        btn.addEventListener('click', (e) => editWord(parseInt(e.target.closest('button').dataset.index)));
    });
    
    document.querySelectorAll('.delete-word').forEach(btn => {
        btn.addEventListener('click', (e) => deleteWord(parseInt(e.target.closest('button').dataset.index)));
    });
    
    // Update counts
    state.learnedWords = state.vocabulary.length;
    elements.vocabCount.textContent = state.learnedWords;
    elements.vocabTotal.textContent = 100; // Could be dynamic based on goals
    
    // Update progress bars
    updateProgressBars();
}

// Add a new word to vocabulary
function addWord() {
    const nativeWord = elements.nativeWordInput.value.trim();
    const translation = elements.translationInput.value.trim();
    
    if (nativeWord && translation) {
        state.vocabulary.push({ native: nativeWord, translation });
        saveState();
        renderVocabulary();
        
        // Clear inputs
        elements.nativeWordInput.value = '';
        elements.translationInput.value = '';
        
        // Update streak if this is first word added today
        updateStreak();
    }
}

// Edit a word
function editWord(index) {
    const word = state.vocabulary[index];
    const newNative = prompt("Edit native word:", word.native);
    const newTranslation = prompt("Edit translation:", word.translation);
    
    if (newNative !== null && newTranslation !== null) {
        word.native = newNative.trim();
        word.translation = newTranslation.trim();
        saveState();
        renderVocabulary();
    }
}

// Delete a word
function deleteWord(index) {
    if (confirm("Are you sure you want to delete this word?")) {
        state.vocabulary.splice(index, 1);
        saveState();
        renderVocabulary();
    }
}

// Search vocabulary
function searchVocabulary() {
    const searchTerm = elements.vocabSearch.value.toLowerCase();
    const items = document.querySelectorAll('.vocabulary-item');
    
    items.forEach(item => {
        const nativeWord = item.querySelector('.native-word').textContent.toLowerCase();
        const translation = item.querySelector('.translation').textContent.toLowerCase();
        
        if (nativeWord.includes(searchTerm) || translation.includes(searchTerm)) {
            item.style.display = 'flex';
        } else {
            item.style.display = 'none';
        }
    });
}

// Update all UI elements
function updateUI() {
    // Update stats
    elements.wordsLearned.textContent = state.learnedWords;
    elements.learningStreak.textContent = state.learningStreak;
    elements.completion.textContent = `${Math.floor((state.vocabProgress + state.grammarProgress + state.convoProgress) / 3)}%`;
    
    // Update progress bars
    updateProgressBars();
}

// Update progress bars
function updateProgressBars() {
    // Vocabulary progress (based on words learned vs goal)
    const vocabPercentage = Math.min(100, (state.learnedWords / 100) * 100);
    elements.vocabProgress.style.width = `${vocabPercentage}%`;
    state.vocabProgress = vocabPercentage;
    
    // Grammar progress (random for demo)
    const grammarPercentage = Math.min(100, state.grammarProgress + Math.random() * 5);
    elements.grammarProgress.style.width = `${grammarPercentage}%`;
    state.grammarProgress = grammarPercentage;
    elements.grammarCount.textContent = Math.floor(grammarPercentage / 5);
    
    // Conversation progress (random for demo)
    const convoPercentage = Math.min(100, state.convoProgress + Math.random() * 5);
    elements.convoProgress.style.width = `${convoPercentage}%`;
    state.convoProgress = convoPercentage;
    elements.convoCount.textContent = Math.floor(convoPercentage / 5);
    
    saveState();
}

// Update learning streak
function updateStreak() {
    const today = new Date().toDateString();
    
    if (!state.lastPracticeDate) {
        // First time practicing
        state.learningStreak = 1;
    } else if (state.lastPracticeDate === today) {
        // Already practiced today
        return;
    } else {
        const lastDate = new Date(state.lastPracticeDate);
        const currentDate = new Date(today);
        const diffTime = currentDate - lastDate;
        const diffDays = diffTime / (1000 * 60 * 60 * 24);
        
        if (diffDays < 2) {
            // Practiced yesterday, increment streak
            state.learningStreak++;
        } else {
            // Break in streak, reset to 1
            state.learningStreak = 1;
        }
    }
    
    state.lastPracticeDate = today;
    saveState();
    updateUI();
}

// Practice functions
let currentPractice = [];
let currentPracticeIndex = 0;
let practiceType = '';

// Start a practice session
function startPractice(type) {
    practiceType = type;
    
    switch (type) {
        case 'vocabulary':
            elements.practiceTitle.textContent = 'Practice Vocabulary';
            currentPractice = [...state.vocabulary];
            break;
        case 'grammar':
            elements.practiceTitle.textContent = 'Practice Grammar';
            // For demo, we'll practice vocabulary as grammar
            currentPractice = [...state.vocabulary].slice(0, 5);
            break;
        case 'conversation':
            elements.practiceTitle.textContent = 'Practice Conversation';
            // For demo, we'll practice vocabulary as conversation
            currentPractice = [...state.vocabulary].slice(0, 3);
            break;
    }
    
    // Shuffle the practice items
    currentPractice = shuffleArray(currentPractice);
    currentPracticeIndex = 0;
    
    // Show first item
    showPracticeItem();
    elements.practiceModal.style.width = 'flex';
    
    // Update streak
    updateStreak();
}

// Close practice modal
function closePracticeModal() {
    elements.practiceModal.style.display = 'none';
}

// Show current practice item
function showPracticeItem() {
    if (currentPracticeIndex >= currentPractice.length) {
        // Practice session complete
        elements.practiceArea.innerHTML = `
            <div class="practice-card">
                <h3>Practice Complete!</h3>
                <p>You've completed ${currentPractice.length} ${practiceType} items.</p>
                <p>Keep up the good work!</p>
            </div>
        `;
        elements.nextPractice.textContent = 'Finish';
        return;
    }
    
    const item = currentPractice[currentPracticeIndex];
    
    if (practiceType === 'vocabulary') {
        // Create flashcard for vocabulary practice
        elements.practiceArea.innerHTML = `
            <div class="flashcard" id="flashcard">
                <div class="flashcard-inner">
                    <div class="flashcard-front">
                        <div class="word">${item.native}</div>
                        <div class="hint">Click to see translation</div>
                    </div>
                    <div class="flashcard-back">
                        <div class="word">${item.translation}</div>
                        <div class="hint">${item.native}</div>
                    </div>
                </div>
            </div>
            <p>Click the card to flip it</p>
        `;
        
        // Add click event to flashcard
        document.getElementById('flashcard').addEventListener('click', function() {
            this.classList.toggle('flipped');
        });
    } else {
        // Simple display for other practice types
        elements.practiceArea.innerHTML = `
            <div class="practice-card">
                <div class="word">${item.native}</div>
                <div class="translation">${item.translation}</div>
            </div>
            <p>Try to say this in ${state.targetLanguage}</p>
        `;
    }
    
    elements.nextPractice.textContent = 'Next';
}

// Move to next practice item
function nextPracticeItem() {
    if (currentPracticeIndex >= currentPractice.length) {
        // Session complete
        closePracticeModal();
        
        // Update progress based on practice type
        switch (practiceType) {
            case 'vocabulary':
                state.vocabProgress = Math.min(100, state.vocabProgress + 5);
                break;
            case 'grammar':
                state.grammarProgress = Math.min(100, state.grammarProgress + 5);
                break;
            case 'conversation':
                state.convoProgress = Math.min(100, state.convoProgress + 5);
                break;
        }
        
        updateUI();
        return;
    }
    
    currentPracticeIndex++;
    showPracticeItem();
}

// Utility function to shuffle array
function shuffleArray(array) {
    const newArray = [...array];
    for (let i = newArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
    }
    return newArray;
}

// Initialize the app when DOM is loaded
document.addEventListener('DOMContentLoaded', init);